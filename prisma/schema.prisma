// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model AdminUser {
  id       Int    @id @default(autoincrement())
  email    String @unique
  name     String
  username String @unique
  password_hash String
}

model NewsArticle {
  id    Int    @id @default(autoincrement())
  title String
  text  String
}

model Contest {
  id    Int           @id @default(autoincrement())
  name String
  year  Int
  from  DateTime
  to    DateTime
  isLocal Boolean
  pdfLink String?
  tasks ContestTask[]
  submissions  ContestSubmission[]
  teams Team[]
  participations TeamParticipation[]
}
 
model ContestTask {
  id         Int     @id @default(autoincrement())
  identifier String
  contest    Contest @relation(fields: [contestId], references: [id])
  contestId  Int
  submissions ContestSubmission[]
}

model Team {
  id          Int          @id @default(autoincrement())
  name        String
  official Boolean @default(true)
  contestants Contestant[]
  submissions ContestSubmission[]
  contests Contest[]
  participations TeamParticipation[]
  goldMedals Int @default(0)
  silverMedals Int @default(0)
  bronzeMedals Int  @default(0)
}

model TeamParticipation {
  id Int @id @default(autoincrement())
  solvedTasks Int
  penalty Int
  rank Int
  medalIndex Int @default(0)
  team Team @relation(fields: [teamId], references: [id])
  contest Contest @relation(fields: [contestId], references: [id])
  teamId Int
  contestId Int
}

model ContestSubmission {
  id Int @id @default(autoincrement())
  submissionTime Int
  isVerdictOk Boolean
  team Team @relation(fields: [teamId], references: [id])
  contest Contest @relation(fields: [contestId], references: [id])
  task ContestTask @relation(fields: [taskId], references: [id])
  teamId Int
  contestId Int
  taskId Int
}

model Contestant {
  id     Int  @id @default(autoincrement())
  team   Team @relation(fields: [teamId], references: [id])
  teamId Int
}

model Album{
  id Int @id @default(autoincrement())
  title String
  photos AlbumPhoto[]
}

model AlbumPhoto{
  id Int @id @default(autoincrement())
  album Album @relation(fields: [albumId], references: [id])
  albumId Int
  photoLink String
}